version: 2

deploy:
  steps:
    terraformPlan:
      before:
        - name: Display ENV0 Environment Variables
          run: |
            echo "=========================================="
            echo "ENV0 ENVIRONMENT VARIABLES"
            echo "=========================================="
            env
      after:
        - name: Submit Plan to Overmind
          use: https://github.com/overmindtech/env0-plugin
          inputs:
            action: submit-plan
            api_key: ${OVM_API_KEY}
    
    terraformApply:
      before:
        - name: Mark Change Started
          use: https://github.com/overmindtech/env0-plugin
          inputs:
            action: start-change
            api_key: ${OVM_API_KEY}

        - name: Display ENV0 Environment Variables
          run: |
            echo "=========================================="
            echo "ENV0 ENVIRONMENT VARIABLES"
            echo "=========================================="
            env
      
      after:
        - name: Mark Change Finished
          use: https://github.com/overmindtech/env0-plugin
          inputs:
            action: end-change
            api_key: ${OVM_API_KEY}

